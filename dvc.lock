schema: '2.0'
stages:
  features_extraction:
    cmd: python -m delius.features_extraction --input_compressed_image_dir ./data/raw/images.tar.gz
      --output_uncompressed_image_dir ./data/interim/images/ --output_embedding_file
      ./data/processed/embeddings.pth --image_width 224 --image_height 224 --batch_size
      256 --seed 42
    deps:
    - path: ./data/raw/images.tar.gz
      hash: md5
      md5: 0c051fb68a3f64e50fb2d4652c9bf9da
      size: 1856987749
    - path: delius/features_extraction.py
      hash: md5
      md5: b380b6b349a75f3aec267f5dd0f101a2
      size: 1984
    outs:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: 7095f293a547615e8c656ddbe2417d75
      size: 493150187
  encoder_pretraining:
    cmd: python -m delius.encoder_pretraining --learning_rate 0.001 --epochs 200 --batch
      256 --encoder_hidden_dimensions 500 500 2000 10 --input_embeddings_file ./data/processed/embeddings.pth
      --output_encoder_mlflow_run_id_path ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: 7095f293a547615e8c656ddbe2417d75
      size: 493150187
    - path: delius/encoder_pretraining.py
      hash: md5
      md5: 85f210b2b9bf16d6e624055aa606ef15
      size: 2277
    outs:
    - path: ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      hash: md5
      md5: 5595ef4cae6d3e7fb0561ae1009a9f0e
      size: 32
  clusters_initialization:
    cmd: python -m delius.clusters_initialization --batch 256 --input_embeddings_file
      ./data/processed/embeddings.pth --input_encoder_mlflow_run_id_path ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      --output_centroids_file ./models/kmeans/centroids.pth --output_assignments_file
      ./models/kmeans/assignments.pth --n_clusters 10 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: 7095f293a547615e8c656ddbe2417d75
      size: 493150187
    - path: ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      hash: md5
      md5: 5595ef4cae6d3e7fb0561ae1009a9f0e
      size: 32
    - path: delius/clusters_initialization.py
      hash: md5
      md5: ae3f9c43517fe85135f1cdcbf224bc38
      size: 2361
    outs:
    - path: ./models/kmeans/assignments.pth
      hash: md5
      md5: bac230c3f7a7c7285e2495156c636854
      size: 932976
    - path: ./models/kmeans/centroids.pth
      hash: md5
      md5: 749099fd7f247dc4a8c8f566cec49345
      size: 1574
  deep_embedded_clustering:
    cmd: python -m delius.deep_embedded_clustering --batch 256 --encoder_hidden_dimensions
      500 500 2000 10 --input_embeddings_dimensions 1024 --input_embeddings_file ./data/processed/embeddings.pth
      --input_pretrained_encoder_file ./models/pretrained/encoder.pth --input_centroids_file
      ./models/kmeans/centroids.pth --input_assignments_file ./models/kmeans/assignments.pth
      --learning_rate 0.001 --steps 8000 --update_interval 140 --delta_tol 0.001 --output_dec_file
      ./models/dec/dec.pth --n_clusters 10 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: ./models/kmeans/assignments.pth
      hash: md5
      md5: 7bf12cb34c7cfed4cdaad44e7730cc21
      size: 932976
    - path: ./models/kmeans/centroids.pth
      hash: md5
      md5: 19a9498242ffd463ff8b8c886a389af4
      size: 1574
    - path: ./models/pretrained/encoder.pth
      hash: md5
      md5: 9e24a48055586955de72469b382b1964
      size: 7143040
    - path: delius/deep_embedded_clustering.py
      hash: md5
      md5: e5ce4e16074d2d93faea052f6c59ca3e
      size: 5797
    outs:
    - path: ./models/dec/dec.pth
      hash: md5
      md5: ed222953f9734ec0661460b4bc368f3d
      size: 7143816
  clusters_visualization:
    cmd: python -m delius.clusters_visualization --batch 256 --input_embeddings_file
      ./data/processed/embeddings.pth --input_dec_file ./models/dec/dec.pth --output_tsne_pic_file
      ./models/clustering_pics/clusters.png --input_embeddings_dimensions 1024 --encoder_hidden_dimensions
      500 500 2000 10 --n_clusters 10 --input_image_dir ./data/interim/images/ --output_clustered_samples_file
      ./models/clustering_pics/samples.png --n_samples_per_cluster 5 --embeddings_sample_fraction
      0.1 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: ./models/dec/dec.pth
      hash: md5
      md5: e10a9c45b83f9576b6c7948a2740b241
      size: 7143816
    - path: delius/clusters_visualization.py
      hash: md5
      md5: 9ac1755ad8a5e6a7f7cab6bf0b24fe50
      size: 2877
    outs:
    - path: ./models/clustering_pics/clusters.png
      hash: md5
      md5: f8167d9a3d2fc26be4a5596eff09a918
      size: 178654
    - path: ./models/clustering_pics/samples.png
      hash: md5
      md5: b2281944d5cf7bda8b5cedec87146712
      size: 950400
  dec_fitting:
    cmd: python -m delius.dec_fitting --batch 256 --input_embeddings_file ./data/processed/embeddings.pth
      --input_encoder_mlflow_run_id_path ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      --input_centroids_file ./models/kmeans/centroids.pth --input_assignments_file
      ./models/kmeans/assignments.pth --learning_rate 0.001 --steps 8000 --update_interval
      140 --delta_tol 0.001 --output_dec_mlflow_run_id_file ./models/mlflow_run_ids/dec_training_mlflow_run_id.txt
      --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: 7095f293a547615e8c656ddbe2417d75
      size: 493150187
    - path: ./models/kmeans/assignments.pth
      hash: md5
      md5: bac230c3f7a7c7285e2495156c636854
      size: 932976
    - path: ./models/kmeans/centroids.pth
      hash: md5
      md5: 749099fd7f247dc4a8c8f566cec49345
      size: 1574
    - path: ./models/mlflow_run_ids/encoder_training_mlflow_run_id.txt
      hash: md5
      md5: 5595ef4cae6d3e7fb0561ae1009a9f0e
      size: 32
    - path: delius/dec_fitting.py
      hash: md5
      md5: 691a08e4abf507ed5fa55516b84cc289
      size: 3601
    outs:
    - path: ./models/mlflow_run_ids/dec_training_mlflow_run_id.txt
      hash: md5
      md5: 022fc47478f64f21c3bb72d5cbda9fc5
      size: 32
  clusters_evaluation:
    cmd: python -m delius.clusters_evaluation --batch 256 --input_embeddings_file
      ./data/processed/embeddings.pth --input_dec_mlflow_run_id_file ./models/mlflow_run_ids/dec_training_mlflow_run_id.txt
      --input_labels_file ./data/processed/labels.csv --input_image_dir ./data/interim/images/
      --n_samples_per_cluster 5 --embeddings_sample_fraction 0.1 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: 7095f293a547615e8c656ddbe2417d75
      size: 493150187
    - path: ./data/processed/labels.csv
      hash: md5
      md5: 9161c7bc450e1cc78fe74d11e9426409
      size: 8533668
    - path: ./models/mlflow_run_ids/dec_training_mlflow_run_id.txt
      hash: md5
      md5: 022fc47478f64f21c3bb72d5cbda9fc5
      size: 32
    - path: delius/clusters_evaluation.py
      hash: md5
      md5: c663f34fe54c97b664278edd2dc4f1b6
      size: 9112
  triples_filtering:
    cmd: python -m delius.triples_filtering --input_triples_file ./data/raw/triples.csv
      --selected_relations hasGenre hasStyle --output_labels_file ./data/processed/labels.csv
    deps:
    - path: ./data/raw/triples.csv
      hash: md5
      md5: d3d798c0961095359b12cd66a6044eca
      size: 70522438
    - path: delius/triples_filtering.py
      hash: md5
      md5: 7f2ef064fed390ec291ac315efaa0b03
      size: 989
    outs:
    - path: ./data/processed/labels.csv
      hash: md5
      md5: 9161c7bc450e1cc78fe74d11e9426409
      size: 8533668
