schema: '2.0'
stages:
  features_extraction:
    cmd: python -m delius.features_extraction --input_compressed_image_dir ./data/raw/images.tar.gz
      --output_uncompressed_image_dir ./data/interim/images/ --output_embedding_file
      ./data/processed/embeddings.pth --image_width 224 --image_height 224 --batch_size
      256
    deps:
    - path: ./data/raw/images.tar.gz
      hash: md5
      md5: a5a0f9454e3dd56c5d7579782c255d9f
      size: 2173727123
    - path: delius/features_extraction.py
      hash: md5
      md5: 4e29013ddbd690168a7b5fc1e6d43723
      size: 4022
    outs:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
  encoder_pretraining:
    cmd: python -m delius.encoder_pretraining --learning_rate 0.001 --epochs 200 --batch
      256 --encoder_hidden_dimensions 500 500 2000 10 --input_embeddings_dimensions
      1024 --input_embeddings_file ./data/processed/embeddings.pth --output_encoder_file
      ./models/pretrained/encoder.pth --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: delius/encoder_pretraining.py
      hash: md5
      md5: feee8c8cdd89450610dd857bd623b467
      size: 2851
    outs:
    - path: ./models/pretrained/encoder.pth
      hash: md5
      md5: 9e24a48055586955de72469b382b1964
      size: 7143040
  clusters_initialization:
    cmd: python -m delius.clusters_initialization --batch 256 --encoder_hidden_dimensions
      500 500 2000 10 --input_embeddings_dimensions 1024 --input_embeddings_file ./data/processed/embeddings.pth
      --input_pretrained_encoder_file ./models/pretrained/encoder.pth --output_centroids_file
      ./models/kmeans/centroids.pth --output_assignments_file ./models/kmeans/assignments.pth
      --n_clusters 10 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: ./models/pretrained/encoder.pth
      hash: md5
      md5: 9e24a48055586955de72469b382b1964
      size: 7143040
    - path: delius/clusters_initialization.py
      hash: md5
      md5: 68b4c30e4cb9f56ddcc92c032ceea3a6
      size: 2835
    outs:
    - path: ./models/kmeans/assignments.pth
      hash: md5
      md5: 7bf12cb34c7cfed4cdaad44e7730cc21
      size: 932976
    - path: ./models/kmeans/centroids.pth
      hash: md5
      md5: 19a9498242ffd463ff8b8c886a389af4
      size: 1574
  deep_embedded_clustering:
    cmd: python -m delius.deep_embedded_clustering --batch 256 --encoder_hidden_dimensions
      500 500 2000 10 --input_embeddings_dimensions 1024 --input_embeddings_file ./data/processed/embeddings.pth
      --input_pretrained_encoder_file ./models/pretrained/encoder.pth --input_centroids_file
      ./models/kmeans/centroids.pth --input_assignments_file ./models/kmeans/assignments.pth
      --learning_rate 0.001 --steps 8000 --update_interval 140 --delta_tol 0.001 --output_dec_file
      ./models/dec/dec.pth --n_clusters 10 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: ./models/kmeans/assignments.pth
      hash: md5
      md5: 7bf12cb34c7cfed4cdaad44e7730cc21
      size: 932976
    - path: ./models/kmeans/centroids.pth
      hash: md5
      md5: 19a9498242ffd463ff8b8c886a389af4
      size: 1574
    - path: ./models/pretrained/encoder.pth
      hash: md5
      md5: 9e24a48055586955de72469b382b1964
      size: 7143040
    - path: delius/deep_embedded_clustering.py
      hash: md5
      md5: e5ce4e16074d2d93faea052f6c59ca3e
      size: 5797
    outs:
    - path: ./models/dec/dec.pth
      hash: md5
      md5: ed222953f9734ec0661460b4bc368f3d
      size: 7143816
  clusters_visualization:
    cmd: python -m delius.clusters_visualization --batch 256 --input_embeddings_file
      ./data/processed/embeddings.pth --input_dec_file ./models/dec/dec.pth --output_tsne_pic_file
      ./models/clustering_pics/clusters.png --input_embeddings_dimensions 1024 --encoder_hidden_dimensions
      500 500 2000 10 --n_clusters 10 --input_image_dir ./data/interim/images/ --output_clustered_samples_file
      ./models/clustering_pics/samples.png --n_samples_per_cluster 5 --embeddings_sample_fraction
      0.1 --seed 42
    deps:
    - path: ./data/processed/embeddings.pth
      hash: md5
      md5: cd17903282a8d13511d3f08485b0a8f1
      size: 493539845
    - path: ./models/dec/dec.pth
      hash: md5
      md5: ed222953f9734ec0661460b4bc368f3d
      size: 7143816
    - path: delius/clusters_visualization.py
      hash: md5
      md5: 5e43ad9b387c1b78e45b4fb27fb9ef7d
      size: 6765
    outs:
    - path: ./models/clustering_pics/clusters.png
      hash: md5
      md5: 7f2a9f9a761d0b7072f5ffa29bd06626
      size: 146767
    - path: ./models/clustering_pics/samples.png
      hash: md5
      md5: 4b6f507ac1cf5f285647d00f80d3fd5d
      size: 950667
